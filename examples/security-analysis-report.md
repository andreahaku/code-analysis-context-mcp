# Security Analysis Report

**Project:** /Users/administrator/Development/Claude/code-analysis-context-mcp
**Framework:** node
**Analyzed:** 2026-01-12T16:01:13.162Z
**Security Score:** 0/100 (critical)

> **Note:** This report was generated by running the `security` tool against its own codebase. The "vulnerabilities" detected are mostly false positives - they are example code patterns within the detector files themselves (e.g., the injection detector contains example SQL patterns to detect). This demonstrates the tool working correctly by identifying vulnerable-looking code patterns.

## Summary

| Severity | Count |
|----------|-------|
| Critical | 1 |
| High | 14 |
| Medium | 2 |
| Low | 0 |
| Info | 0 |
| **Total** | **17** |

## Critical & High Severity Findings

### AC-008: CORS with Credentials and Wildcard Origin

- **Severity:** CRITICAL
- **Category:** A01:2021-Broken Access Control
- **Location:** `src/security/access-control-detector.ts:0`
- **Status:** needs_fix

**Risk:** Browsers actually block this combination, but if bypassed, any site can make authenticated requests

**Remediation:** Never use wildcard origin with credentials. Specify exact allowed origins.

### INJ-009: SQL Injection via Template Literal

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/tools/coverage-analyzer.ts:183`
- **Status:** needs_fix

**Risk:** Attackers can inject malicious SQL to access, modify, or delete database data

**Remediation:** Use parameterized queries with placeholders ($1, $2) instead of string interpolation

### INJ-010: SQL Injection via Template Literal

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/tools/coverage-analyzer.ts:200`
- **Status:** needs_fix

**Risk:** Attackers can inject malicious SQL to access, modify, or delete database data

**Remediation:** Use parameterized queries with placeholders ($1, $2) instead of string interpolation

### INJ-011: SQL Injection via Template Literal

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/tools/coverage-analyzer.ts:260`
- **Status:** needs_fix

**Risk:** Attackers can inject malicious SQL to access, modify, or delete database data

**Remediation:** Use parameterized queries with placeholders ($1, $2) instead of string interpolation

### INJ-012: SQL Injection via Template Literal

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/tools/coverage-analyzer.ts:277`
- **Status:** needs_fix

**Risk:** Attackers can inject malicious SQL to access, modify, or delete database data

**Remediation:** Use parameterized queries with placeholders ($1, $2) instead of string interpolation

### INJ-013: SQL Injection via Template Literal

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/tools/coverage-analyzer.ts:1099`
- **Status:** needs_fix

**Risk:** Attackers can inject malicious SQL to access, modify, or delete database data

**Remediation:** Use parameterized queries with placeholders ($1, $2) instead of string interpolation

### INJ-014: SQL Injection via Template Literal

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/tools/coverage-analyzer.ts:1251`
- **Status:** needs_fix

**Risk:** Attackers can inject malicious SQL to access, modify, or delete database data

**Remediation:** Use parameterized queries with placeholders ($1, $2) instead of string interpolation

### INJ-015: SQL Injection via Template Literal

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/tools/coverage-analyzer.ts:1416`
- **Status:** needs_fix

**Risk:** Attackers can inject malicious SQL to access, modify, or delete database data

**Remediation:** Use parameterized queries with placeholders ($1, $2) instead of string interpolation

### INJ-016: SQL Injection via Template Literal

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/tools/coverage-analyzer.ts:1493`
- **Status:** needs_fix

**Risk:** Attackers can inject malicious SQL to access, modify, or delete database data

**Remediation:** Use parameterized queries with placeholders ($1, $2) instead of string interpolation

### AC-006: CORS Misconfiguration

- **Severity:** HIGH
- **Category:** A01:2021-Broken Access Control
- **Location:** `src/security/access-control-detector.ts:105`
- **Status:** needs_fix

**Risk:** Any website can make authenticated requests to your API, enabling CSRF and data theft

**Remediation:** Specify allowed origins explicitly: cors({ origin: ['https://yourdomain.com'] })

### AC-009: CORS Misconfiguration

- **Severity:** HIGH
- **Category:** A01:2021-Broken Access Control
- **Location:** `src/security/fastify-detector.ts:743`
- **Status:** needs_fix

**Risk:** Any website can make authenticated requests to your API, enabling CSRF and data theft

**Remediation:** Specify allowed origins explicitly: cors({ origin: ['https://yourdomain.com'] })

### REACT-005: Code Injection Risk: new Function()

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/security/injection-detector.ts:557`
- **Status:** needs_fix

**Risk:** Dynamic code execution can lead to XSS and remote code execution

**Remediation:** Avoid eval/Function; use JSON.parse for data, proper parsing for expressions

### REACT-006: Code Injection Risk: new Function()

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/security/injection-detector.ts:578`
- **Status:** needs_fix

**Risk:** Dynamic code execution can lead to XSS and remote code execution

**Remediation:** Avoid eval/Function; use JSON.parse for data, proper parsing for expressions

### REACT-007: Code Injection Risk: new Function()

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/security/injection-detector.ts:579`
- **Status:** needs_fix

**Risk:** Dynamic code execution can lead to XSS and remote code execution

**Remediation:** Avoid eval/Function; use JSON.parse for data, proper parsing for expressions

### REACT-008: Code Injection Risk: new Function()

- **Severity:** HIGH
- **Category:** A03:2021-Injection
- **Location:** `src/security/react-detector.ts:712`
- **Status:** needs_fix

**Risk:** Dynamic code execution can lead to XSS and remote code execution

**Remediation:** Avoid eval/Function; use JSON.parse for data, proper parsing for expressions

## Medium Severity Findings

### MISC-003: Missing Security Headers (Helmet)

- **Severity:** MEDIUM
- **Category:** A05:2021-Security Misconfiguration
- **Location:** `src/index.ts:0`
- **Status:** review

**Risk:** Missing headers like CSP, X-Frame-Options expose app to XSS, clickjacking

**Remediation:** Add Helmet middleware: app.register(require('@fastify/helmet'))

### MISC-004: Missing Security Headers (Helmet)

- **Severity:** MEDIUM
- **Category:** A05:2021-Security Misconfiguration
- **Location:** `src/types/index.ts:0`
- **Status:** review

**Risk:** Missing headers like CSP, X-Frame-Options expose app to XSS, clickjacking

**Remediation:** Add Helmet middleware: app.register(require('@fastify/helmet'))

## Positive Security Practices (69 found)

The analyzer also detected numerous good security practices in the codebase:

| Category | Practice | File |
|----------|----------|------|
| Input Validation | Input Sanitization | `src/index.ts` |
| Cookies | Secure Cookie Configuration | `src/types/index.ts` |
| Access Control | Authentication Hooks | `src/types/index.ts` |
| Input Validation | Input Sanitization | `src/tools/context-pack-generator.ts` |
| Input Validation | Input Sanitization | `src/tools/dependency-mapper.ts` |
| Error Handling | React Error Boundary | `src/tools/pattern-detector.ts` |
| Cookies | Secure Cookie Configuration | `src/tools/pattern-detector.ts` |
| Database | Parameterized Queries | `src/tools/pattern-detector.ts` |
| Access Control | Authentication Middleware | `src/security/access-control-detector.ts` |
| Cookies | Secure Cookie Configuration | `src/security/access-control-detector.ts` |
| Access Control | CORS with Specific Origins | `src/security/access-control-detector.ts` |
| Crypto | Cryptographically Secure Random | `src/security/crypto-detector.ts` |
| Crypto | Environment Variables for Secrets | `src/security/crypto-detector.ts` |
| Crypto | Scrypt Password Hashing | `src/security/crypto-detector.ts` |
| Input Validation | Schema Validation | `src/security/fastify-detector.ts` |
| Rate Limiting | Rate Limiting Implementation | `src/security/fastify-detector.ts` |
| Headers | Security Headers (Helmet) | `src/security/fastify-detector.ts` |
| Database | Parameterized Queries | `src/security/injection-detector.ts` |
| Error Handling | Centralized Error Handler | `src/security/misconfiguration-detector.ts` |
| Configuration | Environment-Aware Configuration | `src/security/misconfiguration-detector.ts` |
| ... | ... | ... |

## Dependency Vulnerability Analysis

The security tool now includes **Dependabot-like dependency scanning** that checks all npm packages against the OSV (Open Source Vulnerabilities) database.

### Dependency Summary

| Metric | Value |
|--------|-------|
| Total Dependencies | 15 |
| Production | 7 |
| Development | 8 |
| Vulnerable | 0 |

### Vulnerable Dependencies

âœ… **No known vulnerabilities found** in project dependencies.

This is the ideal state - all dependencies are up-to-date and have no known security issues.

### Dependency Security Practices Detected

| Practice | Description | File |
|----------|-------------|------|
| Package Lockfile | Uses package-lock.json to lock versions | `package-lock.json` |
| Engine Constraints | Specifies Node.js >=18.0.0 | `package.json` |

### Example: What Vulnerable Dependencies Look Like

If vulnerabilities were found, they would appear like this:

```
### DEP-001: lodash@4.17.15: Prototype Pollution

- **Severity:** HIGH
- **Category:** A06:2021-Vulnerable Components
- **CVE:** CVE-2021-23337
- **GHSA:** GHSA-35jh-r3h4-6jhm
- **Fixed in:** 4.17.21

**Risk:** Using lodash@4.17.15 which has a known high severity vulnerability (CVE-2021-23337)

**Remediation:** Upgrade lodash to version 4.17.21 or later
```

### How Dependency Scanning Works

The tool:
1. Reads `package.json` and `package-lock.json`
2. Extracts all dependencies with exact versions
3. Queries the [OSV API](https://osv.dev/) (Open Source Vulnerabilities database)
4. Maps findings to OWASP A06:2021 (Vulnerable and Outdated Components)
5. Provides remediation advice with fixed versions

### Filtering by Dependencies Only

To scan only dependencies (skip code analysis):
```json
{
  "tool": "security",
  "args": {
    "path": "/your/project",
    "cats": ["dependencies"]
  }
}
```

## Analysis Metrics

| Metric | Value |
|--------|-------|
| Files Analyzed | 22 |
| Lines Analyzed | 18,022 |
| Security-Related Files | 10 |
| Average Complexity | 103.3 |
| High Complexity Files | 18 |
| Total Positive Patterns | 69 |
| Total Anti-Patterns | 17 |

## Recommendations

### IMMEDIATE: Address Critical Security Vulnerabilities

1 critical vulnerability found: CORS with Credentials and Wildcard Origin. These pose immediate security risks.

### HIGH: Fix High-Severity Issues

14 high-severity issues found. These should be addressed in the next sprint.

### HIGH: Address Injection Vulnerabilities

12 potential injection points found. Implement parameterized queries and proper input sanitization.

### HIGH: Review Access Control Implementation

3 access control issues found. Verify authentication and authorization on all sensitive routes.

### MEDIUM: Implement Security Review Process

Consider adding security-focused code review checklist and automated security scanning to CI/CD pipeline.

---

## Understanding This Report

This report demonstrates the security analysis tool by running it against its own codebase. The findings can be categorized as:

### Expected False Positives (Detector Example Code)

The security detector files contain example code patterns that they're designed to detect. For example:

- `src/security/injection-detector.ts` contains patterns like `new Function()` because it needs to detect this pattern
- `src/security/access-control-detector.ts` contains `origin: '*'` as an example of what to detect
- `src/security/fastify-detector.ts` contains CORS misconfiguration examples

These are **false positives** in the context of this codebase because they're string literals used for pattern matching, not actual vulnerable code.

### Legitimate Findings

- **Missing Helmet headers**: True for `src/index.ts` since this is an MCP server using stdio transport, not an HTTP server. However, this is noted for completeness.
- **Template literals in coverage-analyzer.ts**: These are used for generating test scaffolds, not SQL queries. The detector pattern matched because it looks for template literals containing certain keywords.

### How to Use This Report

When analyzing your own codebase:

1. **Critical & High findings**: Review immediately, prioritize fixes
2. **Medium findings**: Schedule for upcoming sprints
3. **Positive patterns**: Ensure these good practices are maintained
4. **False positives**: Use the `exc` (exclude) parameter to skip known-safe files

Example to exclude detector files:
```json
{
  "tool": "security",
  "args": {
    "path": "/your/project",
    "exc": ["**/security/*-detector.ts"]
  }
}
```
